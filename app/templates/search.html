{% extends 'base.html' %}

{% block title %}
    {% if main_artist %}
        {{ main_artist.name }} - Artist Metrics
    {% else %}
        Search Artist - Spotify Metrics
    {% endif %}
{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6 text-center">Search for an Artist</h1>

{# Search Form (unchanged) #}
<div class="mb-8 max-w-xl mx-auto">
    <form method="GET" action="{{ url_for('main.search_artist') }}" class="flex items-center bg-gray-800 rounded-full shadow-md overflow-hidden">
        <input type="text" name="query" placeholder="Enter artist name..." value="{{ query or '' }}" required class="w-full px-6 py-3 bg-transparent text-white focus:outline-none">
        <button type="submit" class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold transition duration-300">Search</button>
    </form>
</div>

{# Display Search Results #}
{% if search_performed %}
    {% if main_artist %}
        {# Artist Found - Display Details using Partial #}
        <h2 class="text-2xl font-bold mb-4 text-center text-green-300">Search Result: {{ main_artist.name }}</h2>

        {# Links to related pages - ONLY show if artist found #}
        <div class="text-center mb-8 flex flex-wrap justify-center gap-4">
             <a href="{{ url_for('main.similar_genre_artists', artist_id=main_artist.id) }}" class="inline-block px-6 py-2 bg-blue-500 rounded text-lg font-semibold hover:bg-blue-600 transition duration-300">
                View Similar Genre Artists
             </a>
             <a href="{{ url_for('playlists.playlist_finder', artist_id=main_artist.id) }}" class="inline-block px-6 py-2 bg-purple-600 rounded text-lg font-semibold hover:bg-purple-700 transition duration-300">
                Find Playlists for Artist
             </a>
        </div>

        {# Set variables for the partial #}
        {% set display_artist = main_artist %}
        {% set display_releases = main_artist_releases %}
        {% set top_tracks = top_tracks %}
        {% set release_stats = release_stats %}

        {# Include the partial to display artist info #}
        {% include '_artist_display.html' %}

        {% else %}
        {# No artist found message #}
        <div class="text-center p-10 bg-gray-800 rounded-lg shadow-xl">
            <h2 class="text-2xl font-semibold mb-4">No Artist Found</h2>
            {% if query %}
                <p class="text-gray-400">Could not find any artist matching "{{ query }}". Please try a different search term.</p>
            {% else %}
                 <p class="text-gray-400">Could not retrieve details for the previously searched artist.</p>
            {% endif %}
        </div>
    {% endif %}
{% else %}
   {# Initial state BEFORE first search OR if session is empty #}
   <div class="text-center p-10 bg-gray-800 rounded-lg shadow-xl">
       <p class="text-gray-400">Enter an artist name above to view their metrics. The last searched artist will be shown if you return to this page.</p>
   </div>
{% endif %} {# end search_performed #}

{% endblock %}